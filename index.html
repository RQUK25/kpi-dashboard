<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recruitment KPI Dashboard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f5f5f5; padding: 20px; }
        .container { max-width: 1400px; margin: 0 auto; }
        h1 { font-size: 2.5rem; color: #1f2937; margin-bottom: 10px; }
        .subtitle { color: #6b7280; margin-bottom: 30px; }
        .filters { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); margin-bottom: 30px; display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; }
        .filter-group label { display: block; font-size: 0.875rem; font-weight: 600; color: #374151; margin-bottom: 8px; }
        .filter-group select { width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 1rem; }
        .section-title { font-size: 1.5rem; font-weight: bold; color: #1f2937; margin-bottom: 20px; display: flex; align-items: center; gap: 10px; }
        .leaderboards { display: grid; grid-template-columns: repeat(5, 1fr); gap: 16px; margin-bottom: 40px; }
        @media (max-width: 1400px) { .leaderboards { grid-template-columns: repeat(3, 1fr); } }
        @media (max-width: 900px) { .leaderboards { grid-template-columns: repeat(2, 1fr); } }
        @media (max-width: 600px) { .leaderboards { grid-template-columns: 1fr; } }
        .leaderboard-card { background: white; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); padding: 24px; border-top: 4px solid; }
        .leaderboard-header { display: flex; align-items: center; gap: 12px; margin-bottom: 20px; }
        .leaderboard-icon { width: 48px; height: 48px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; }
        .leaderboard-title { font-size: 1.125rem; font-weight: bold; color: #1f2937; }
        .leaderboard-item { display: flex; align-items: center; gap: 12px; padding: 12px; border-radius: 8px; margin-bottom: 8px; border: 1px solid #e5e7eb; transition: all 0.2s; }
        .leaderboard-item:hover { box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .leaderboard-item.first { border: 2px solid; }
        .rank-badge { width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; color: white; font-size: 0.875rem; }
        .leaderboard-name { flex: 1; font-weight: 600; color: #1f2937; }
        .leaderboard-value { font-size: 1.125rem; font-weight: bold; }
        .chart-container { background: white; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); padding: 24px; margin-bottom: 30px; }
        .chart-title { font-size: 1.25rem; font-weight: bold; color: #1f2937; margin-bottom: 20px; display: flex; align-items: center; gap: 10px; }
        .funnel { display: flex; flex-direction: column; align-items: center; padding: 20px 0; }
        .funnel-stage { border-radius: 8px; color: white; font-weight: bold; padding: 16px 32px; margin-bottom: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); display: flex; justify-content: space-between; align-items: center; transition: all 0.2s; }
        .funnel-stage:hover { box-shadow: 0 4px 8px rgba(0,0,0,0.2); transform: translateY(-2px); }
        .conversion-rate { font-size: 0.875rem; font-weight: 600; color: #6b7280; margin: 4px 0 12px 0; }
        .metrics-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 16px; margin-bottom: 30px; }
        .metric-tile { background: white; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); padding: 20px; text-align: center; }
        .metric-icon { font-size: 1.5rem; margin-bottom: 8px; }
        .metric-value { font-size: 1.75rem; font-weight: bold; color: #1f2937; margin-bottom: 4px; }
        .metric-label { font-size: 0.75rem; color: #6b7280; }
        .bars-container { display: flex; gap: 8px; align-items: flex-end; height: 200px; margin-top: 20px; position: relative; padding-bottom: 50px; }
        .bar-group { flex: 1; display: flex; flex-direction: column; align-items: center; }
        .bar { width: 100%; border-radius: 4px 4px 0 0; transition: all 0.3s; }
        .bar:hover { opacity: 0.8; }
        .bar-label { font-size: 0.75rem; color: #6b7280; margin-top: 8px; text-align: center; }
        .pie-container { display: flex; justify-content: center; align-items: center; margin: 20px 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Recruitment KPI Dashboard</h1>
        <p class="subtitle">Track your team's performance and celebrate wins</p>
        
        <div class="filters">
            <div class="filter-group">
                <label>Period Type</label>
                <select id="periodType" onchange="updateDashboard()">
                    <option value="week">Week</option>
                    <option value="month">Month</option>
                    <option value="ytd">YTD</option>
                </select>
            </div>
            <div class="filter-group" id="weekFilter">
                <label>Select Week</label>
                <select id="weekSelect" onchange="updateDashboard()">
                    <option>Week 1</option>
                    <option>Week 2</option>
                    <option>Week 3</option>
                    <option selected>Week 4</option>
                </select>
            </div>
            <div class="filter-group">
                <label>Team Member</label>
                <select id="userSelect" onchange="updateDashboard()">
                    <option>All Team</option>
                    <option>Ben</option>
                    <option>Millie</option>
                    <option>Jake</option>
                </select>
            </div>
        </div>

        <div class="section-title">üèÜ Leaderboards</div>
        <div class="leaderboards" id="leaderboards"></div>

        <div class="chart-container">
            <div class="chart-title">üìÖ Daily Activity Trends</div>
            <div class="bars-container" id="activityChart"></div>
        </div>

        <div class="chart-container">
            <div class="chart-title">üîÑ Conversion Funnel</div>
            <div class="funnel" id="funnelChart"></div>
        </div>

        <div class="chart-container">
            <div class="chart-title">üíº Top Clients by Revenue</div>
            <div class="pie-container">
                <canvas id="pieChart" width="400" height="400"></canvas>
            </div>
        </div>

        <div class="metrics-grid" id="topMetrics"></div>
        <div class="metrics-grid" id="bottomMetrics"></div>
    </div>

    <script>
        // Generate sample data
        function generateData() {
            const users = ['Ben', 'Millie', 'Jake'];
            const data = [];
            for (let week = 1; week <= 4; week++) {
                for (let day = 1; day <= 7; day++) {
                    users.forEach(user => {
                        data.push({
                            date: `2025-10-${String((week - 1) * 7 + day).padStart(2, '0')}`,
                            week: `Week ${week}`,
                            user: user,
                            callsMade: Math.floor(Math.random() * 20) + 5,
                            clientMeetingsBooked: Math.floor(Math.random() * 5),
                            termsSent: Math.floor(Math.random() * 3),
                            termsSigned: Math.floor(Math.random() * 2),
                            jobAdvertPlaced: Math.floor(Math.random() * 2),
                            candidateRegistered: Math.floor(Math.random() * 4),
                            candidatesMarketedOut: Math.floor(Math.random() * 8),
                            interviewBooked: Math.floor(Math.random() * 3),
                            offerMade: Math.floor(Math.random() * 2),
                            placementsMade: Math.random() > 0.85 ? 1 : 0,
                            placementValue: Math.random() > 0.85 ? Math.floor(Math.random() * 8000) + 3000 : 0,
                            placementClient: Math.random() > 0.85 ? ['Tech Corp', 'Finance Ltd', 'Healthcare Inc', 'Retail Co'][Math.floor(Math.random() * 4)] : ''
                        });
                    });
                }
            }
            return data;
        }

        let allData = generateData();

        function filterData() {
            const periodType = document.getElementById('periodType').value;
            const week = document.getElementById('weekSelect').value;
            const user = document.getElementById('userSelect').value;
            
            return allData.filter(d => {
                const periodMatch = periodType === 'week' ? d.week === week : true;
                const userMatch = user === 'All Team' || d.user === user;
                return periodMatch && userMatch;
            });
        }

        function aggregateMetrics(data) {
            return data.reduce((acc, row) => ({
                callsMade: acc.callsMade + row.callsMade,
                clientMeetingsBooked: acc.clientMeetingsBooked + row.clientMeetingsBooked,
                termsSent: acc.termsSent + row.termsSent,
                termsSigned: acc.termsSigned + row.termsSigned,
                jobAdvertPlaced: acc.jobAdvertPlaced + row.jobAdvertPlaced,
                candidateRegistered: acc.candidateRegistered + row.candidateRegistered,
                candidatesMarketedOut: acc.candidatesMarketedOut + row.candidatesMarketedOut,
                interviewBooked: acc.interviewBooked + row.interviewBooked,
                offerMade: acc.offerMade + row.offerMade,
                placementsMade: acc.placementsMade + row.placementsMade,
                totalBillings: acc.totalBillings + row.placementValue
            }), {
                callsMade: 0, clientMeetingsBooked: 0, termsSent: 0, termsSigned: 0,
                jobAdvertPlaced: 0, candidateRegistered: 0, candidatesMarketedOut: 0,
                interviewBooked: 0, offerMade: 0, placementsMade: 0, totalBillings: 0
            });
        }

        function calculateLeaderboards(data) {
            const userStats = {};
            data.forEach(row => {
                if (!userStats[row.user]) {
                    userStats[row.user] = {
                        user: row.user,
                        placementsMade: 0,
                        totalBillings: 0,
                        callsMade: 0,
                        candidatesMarketedOut: 0,
                        interviewBooked: 0
                    };
                }
                userStats[row.user].placementsMade += row.placementsMade;
                userStats[row.user].totalBillings += row.placementValue;
                userStats[row.user].callsMade += row.callsMade;
                userStats[row.user].candidatesMarketedOut += row.candidatesMarketedOut;
                userStats[row.user].interviewBooked += row.interviewBooked;
            });
            
            const users = Object.values(userStats);
            return {
                placements: [...users].sort((a, b) => b.placementsMade - a.placementsMade),
                billings: [...users].sort((a, b) => b.totalBillings - a.totalBillings),
                calls: [...users].sort((a, b) => b.callsMade - a.callsMade),
                candidates: [...users].sort((a, b) => b.candidatesMarketedOut - a.candidatesMarketedOut),
                interviews: [...users].sort((a, b) => b.interviewBooked - a.interviewBooked)
            };
        }

        function renderLeaderboard(title, data, metric, color, prefix = '') {
            return `
                <div class="leaderboard-card" style="border-top-color: ${color};">
                    <div class="leaderboard-header">
                        <div class="leaderboard-icon" style="background: ${color}20;">${title.split(' ')[0]}</div>
                        <div class="leaderboard-title">${title}</div>
                    </div>
                    ${data.map((user, i) => `
                        <div class="leaderboard-item ${i === 0 ? 'first' : ''}" style="${i === 0 ? `background: ${color}10; border-color: ${color};` : ''}">
                            <div class="rank-badge" style="background: ${i === 0 ? color : '#9ca3af'};">${i + 1}</div>
                            <div class="leaderboard-name">${user.user}</div>
                            <div class="leaderboard-value" style="color: ${i === 0 ? color : '#374151'};">
                                ${prefix}${user[metric].toLocaleString()}
                            </div>
                            ${i === 0 ? 'üèÜ' : ''}
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function renderActivityChart(data) {
            const daily = {};
            data.forEach(row => {
                if (!daily[row.date]) {
                    daily[row.date] = { calls: 0, candidates: 0, interviews: 0, placements: 0 };
                }
                daily[row.date].calls += row.callsMade;
                daily[row.date].candidates += row.candidatesMarketedOut;
                daily[row.date].interviews += row.interviewBooked;
                daily[row.date].placements += row.placementsMade;
            });
            
            const dates = Object.keys(daily).sort().slice(-7);
            const maxValue = Math.max(...dates.map(d => Math.max(daily[d].calls, daily[d].candidates, daily[d].interviews, daily[d].placements * 20)));
            
            return dates.map(date => {
                const d = daily[date];
                return `
                <div class="bar-group">
                    <div style="display: flex; gap: 2px; align-items: flex-end; height: 180px;">
                        <div class="bar" style="height: ${(d.calls / maxValue * 180)}px; background: #3b82f6;" title="Calls: ${d.calls}"></div>
                        <div class="bar" style="height: ${(d.candidates / maxValue * 180)}px; background: #10b981;" title="Candidates: ${d.candidates}"></div>
                        <div class="bar" style="height: ${(d.interviews / maxValue * 180)}px; background: #f59e0b;" title="Interviews: ${d.interviews}"></div>
                        <div class="bar" style="height: ${(d.placements * 20 / maxValue * 180)}px; background: #ef4444;" title="Placements: ${d.placements}"></div>
                    </div>
                    <div class="bar-label">${date.slice(-2)}</div>
                </div>
            `;
            }).join('') + `
                <div style="position: absolute; bottom: -40px; left: 0; right: 0; display: flex; justify-content: center; gap: 20px; font-size: 0.875rem;">
                    <div><span style="display: inline-block; width: 12px; height: 12px; background: #3b82f6; border-radius: 2px;"></span> Calls</div>
                    <div><span style="display: inline-block; width: 12px; height: 12px; background: #10b981; border-radius: 2px;"></span> Candidates</div>
                    <div><span style="display: inline-block; width: 12px; height: 12px; background: #f59e0b; border-radius: 2px;"></span> Interviews</div>
                    <div><span style="display: inline-block; width: 12px; height: 12px; background: #ef4444; border-radius: 2px;"></span> Placements</div>
                </div>
            `;
        }

        function renderFunnel(metrics) {
            const stages = [
                { name: 'Calls', value: metrics.callsMade, color: '#3b82f6', nextValue: metrics.clientMeetingsBooked },
                { name: 'Meetings', value: metrics.clientMeetingsBooked, color: '#10b981', nextValue: metrics.termsSent },
                { name: 'Terms Sent', value: metrics.termsSent, color: '#f59e0b', nextValue: metrics.termsSigned },
                { name: 'Terms Signed', value: metrics.termsSigned, color: '#ef4444', nextValue: metrics.interviewBooked },
                { name: 'Interviews', value: metrics.interviewBooked, color: '#8b5cf6', nextValue: metrics.offerMade },
                { name: 'Offers', value: metrics.offerMade, color: '#ec4899', nextValue: metrics.placementsMade },
                { name: 'Placements', value: metrics.placementsMade, color: '#06b6d4', nextValue: null }
            ];
            
            return stages.map((stage, i) => {
                const conversionRate = stage.value > 0 && stage.nextValue !== null 
                    ? (stage.nextValue / stage.value * 100).toFixed(1) 
                    : null;
                    
                return `
                <div style="width: 100%; display: flex; flex-direction: column; align-items: center;">
                    <div class="funnel-stage" style="width: ${100 - i * 12}%; background: ${stage.color};">
                        <span>${stage.name}</span>
                        <span>${stage.value}</span>
                    </div>
                    ${conversionRate !== null ? `<div class="conversion-rate">‚Üì ${conversionRate}% conversion</div>` : ''}
                </div>
            `;
            }).join('');
        }

        function drawPieChart(data) {
            const canvas = document.getElementById('pieChart');
            const ctx = canvas.getContext('2d');
            const clients = {};
            
            data.forEach(row => {
                if (row.placementClient && row.placementValue > 0) {
                    clients[row.placementClient] = (clients[row.placementClient] || 0) + row.placementValue;
                }
            });
            
            const clientData = Object.entries(clients).sort((a, b) => b[1] - a[1]).slice(0, 5);
            if (clientData.length === 0) {
                clientData.push(['Tech Corp', 25000], ['Finance Ltd', 18000], ['Healthcare Inc', 15000], ['Retail Co', 8000]);
            }
            
            const total = clientData.reduce((sum, [, val]) => sum + val, 0);
            const colors = ['#3b82f6', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6'];
            
            ctx.clearRect(0, 0, 400, 400);
            let currentAngle = -Math.PI / 2;
            
            clientData.forEach(([name, value], i) => {
                const sliceAngle = (value / total) * 2 * Math.PI;
                ctx.fillStyle = colors[i];
                ctx.beginPath();
                ctx.moveTo(200, 200);
                ctx.arc(200, 200, 150, currentAngle, currentAngle + sliceAngle);
                ctx.closePath();
                ctx.fill();
                
                const midAngle = currentAngle + sliceAngle / 2;
                const labelX = 200 + Math.cos(midAngle) * 100;
                const labelY = 200 + Math.sin(midAngle) * 100;
                ctx.fillStyle = 'white';
                ctx.font = 'bold 14px sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText(`${name}`, labelX, labelY);
                ctx.fillText(`¬£${value.toLocaleString()}`, labelX, labelY + 20);
                
                currentAngle += sliceAngle;
            });
        }

        function updateDashboard() {
            const filtered = filterData();
            const metrics = aggregateMetrics(filtered);
            const leaderboards = calculateLeaderboards(filtered);
            
            document.getElementById('leaderboards').innerHTML = 
                renderLeaderboard('üèÜ Top Placements', leaderboards.placements, 'placementsMade', '#3b82f6') +
                renderLeaderboard('üí∞ Top Biller', leaderboards.billings, 'totalBillings', '#10b981', '¬£') +
                renderLeaderboard('üìû Top Caller', leaderboards.calls, 'callsMade', '#f59e0b') +
                renderLeaderboard('üì§ Most Candidates Sent', leaderboards.candidates, 'candidatesMarketedOut', '#ef4444') +
                renderLeaderboard('üé§ Most Interviews', leaderboards.interviews, 'interviewBooked', '#8b5cf6');
            
            document.getElementById('activityChart').innerHTML = renderActivityChart(filtered);
            document.getElementById('funnelChart').innerHTML = renderFunnel(metrics);
            drawPieChart(filtered);
            
            document.getElementById('topMetrics').innerHTML = `
                <div class="metric-tile"><div class="metric-icon">üí∞</div><div class="metric-value">¬£${metrics.totalBillings.toLocaleString()}</div><div class="metric-label">Total Billings</div></div>
                <div class="metric-tile"><div class="metric-icon">üèÜ</div><div class="metric-value">${metrics.placementsMade}</div><div class="metric-label">Placements Made</div></div>
                <div class="metric-tile"><div class="metric-icon">üéØ</div><div class="metric-value">${metrics.interviewBooked}</div><div class="metric-label">Interviews Booked</div></div>
                <div class="metric-tile"><div class="metric-icon">üì§</div><div class="metric-value">${metrics.candidatesMarketedOut}</div><div class="metric-label">Candidates Sent</div></div>
                <div class="metric-tile"><div class="metric-icon">üìû</div><div class="metric-value">${metrics.callsMade}</div><div class="metric-label">Calls Made</div></div>
            `;
            
            document.getElementById('bottomMetrics').innerHTML = `
                <div class="metric-tile"><div class="metric-icon">üìÖ</div><div class="metric-value">${metrics.clientMeetingsBooked}</div><div class="metric-label">Meetings Booked</div></div>
                <div class="metric-tile"><div class="metric-icon">‚úÖ</div><div class="metric-value">${metrics.termsSigned}</div><div class="metric-label">Terms Signed</div></div>
                <div class="metric-tile"><div class="metric-icon">üìÑ</div><div class="metric-value">${metrics.termsSent}</div><div class="metric-label">Terms Sent</div></div>
                <div class="metric-tile"><div class="metric-icon">üë§</div><div class="metric-value">${metrics.candidateRegistered}</div><div class="metric-label">Candidates Registered</div></div>
                <div class="metric-tile"><div class="metric-icon">üíº</div><div class="metric-value">${metrics.jobAdvertPlaced}</div><div class="metric-label">Job Ads Placed</div></div>
            `;
        }

        updateDashboard();
    </script>
</body>
</html>
